<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Completar Transacción | MercaNova</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
  <style>
    body { background: #f5f6fa; font-family: 'Segoe UI', sans-serif; }
    .card { border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
    .titulo { font-weight: bold; color: #2c3e50; }
    .btn-pago { font-size: 1.2rem; padding: 12px; border-radius: 50px; background: #0070ba; border: none; transition: all 0.3s ease; }
    .btn-pago:disabled { background: #cfcfcf; cursor: not-allowed; transform: scale(1); }
    .btn-pago:not(:disabled):hover { transform: scale(1.05); box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
    .resumen-fijo { position: sticky; top: 20px; }
    .pago-opcion { border: 1px solid #ccc; padding: 12px; border-radius: 8px; cursor: pointer; transition: all 0.3s ease; }
    .pago-opcion.active { border: 2px solid #0070ba; background: #f1faff; transform: scale(1.02); }
    #datosTarjeta { display: none; overflow: hidden; transition: max-height 0.4s ease-in-out; }
    .campo-error { border: 2px solid #dc3545 !important; animation: shake 0.3s ease; }
    @keyframes shake { 
      0% { transform: translateX(0); } 
      25% { transform: translateX(-5px); } 
      50% { transform: translateX(5px); } 
      75% { transform: translateX(-5px); } 
      100% { transform: translateX(0); } 
    }
    #menuDesplegable {
      display: none;
      position: absolute;
      top: 70px;
      right: 40px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
      z-index: 999;
    }

    #menuDesplegable a {
      display: block;
      padding: 10px 20px;
      text-decoration: none;
      color: #333;
    }

    #menuDesplegable a:hover {
      background-color: #f57c00;
      color: white;
    }
    #hamburguesaBtn{
      cursor: pointer;
    }
    * {
    margin: 0;                /* Elimina cualquier margen por defecto */
    padding: 0;               /* Elimina cualquier relleno por defecto */
    box-sizing: border-box;  /* Incluye el padding y borde dentro del tamaño total del elemento */
  }
  
  /* Estilos generales del body */
  body {
    font-family: sans-serif; /* Fuente principal para todo el sitio */
    background-color: white;           /* Fondo blanco muy claro */
    color: #333;                         /* Color del texto en gris oscuro */
  }
  
  /* Estilos para la barra de navegación */
  nav {
    top: 0;                             /* Alineación en la parte superior */
    width: 100%;                        /* Ocupa todo el ancho disponible */
    padding: 20px 40px;                 /* Espaciado interno (arriba/abajo 20px, izquierda/derecha 40px) */
    background-color: rgba(0, 0, 0, 0.7); /* Fondo negro con transparencia (70%) */
    display: flex;                      /* Usamos flexbox para distribuir los elementos internos */
    justify-content: space-between;    /* Coloca los elementos a los extremos (logo y menú) */
    align-items: center;               /* Centra verticalmente los elementos */ 
    z-index: 1000;                     /* Se asegura de estar por encima de otros elementos */
  }
  .logo {
    width: 200px;
    height: 50px;
  }
  
  /* Estilo para los enlaces del menú */
  .menu a {
    margin-left: 28px;             /* Espacio entre los enlaces */
    color: white;                  /* Color del texto */
    text-decoration: none;         /* Sin subrayado */
    font-weight: 500;              /* Peso de fuente medio */
    transition: color 0.3s;        /* Transición suave de color en hover */
  }
  
  /* Cambio de color al pasar el mouse por los enlaces */
  .menu a:hover {
    color: #f57c00;                /* Color naranja al pasar el mouse */
  }
     /* Estilo para el contador de compras */
#contador-compras .contador-numero {
  position: absolute;
  top: -8px;
  right: -8px;
  background: #f57c00;
  color: white;
  border-radius: 50%;
  width: 20px;
  height: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 12px;
  font-weight: bold;
}
  </style>
</head>
<body>
    <!-- Navegación superior -->
    <nav>
      <img src="img-principal/logo.png" alt="Logo MercaNova" class="logo" />
      <div class="menu">
        <a href="principal.html"><img src="img-principal/hogar.png" alt="Inicio" /></a>
        <a href="productos.html"><img src="img-principal/caja-abierta.png" alt="Productos" /></a>
        <a href="favoritos.html"><img src="img-principal/corazon.png" alt="Favoritos" /></a>
        <a href="comprar.html" id="contador-compras" style="position: relative;">
          <img src="img-principal/carrito-de-compras.png" alt="Carrito" />
          <span class="contador-numero">0</span>
        </a>
  
        <button id="hamburguesaBtn" style="background:none; border:none;">
          <img src="img-principal/menu-hamburguesa.png" alt="Menú" style="width:18px; margin-left: 28px;" />
        </button>
      </div>
    </nav>
  
    <!-- Menú desplegable -->
    <div id="menuDesplegable">
      <a href="perfil.html">Mi perfil</a>
      <a href="ayuda-y-ajustes.html">Configuración</a>
      <a href="nosotros.html">Sobre Nosotros</a>
      <a href="comprador.html">Comprador</a>
    </div>

  <div class="container my-5">
    <h2 class="text-center titulo mb-4">Completar transacción</h2>
    <div class="row g-4">
      
      <!-- Columna izquierda -->
      <div class="col-lg-7">
        <!-- Teléfono y País -->
        <div class="card p-4 mb-4">
          <h5 class="mb-3">Número de teléfono</h5>
          <div class="input-group">
            <select class="form-select" id="codigoPais" style="max-width:150px;">
              <option value="+503">🇸🇻 El Salvador +503</option>
              <option value="+502">🇬🇹 Guatemala +502</option>
              <option value="+505">🇳🇮 Nicaragua +505</option>
              <option value="+506">🇨🇷 Costa Rica +506</option>
            </select>
            <input type="text" class="form-control" id="telefono" placeholder="Número de teléfono (obligatorio)">
          </div>
        </div>

        <!-- Dirección -->
        <div class="card p-4 mb-4">
          <h5 class="mb-3">Dirección de envío</h5>
          <form id="formEnvio" class="row g-3">
            <div class="col-md-6"><input type="text" class="form-control" placeholder="Nombre"></div>
            <div class="col-md-6"><input type="text" class="form-control" placeholder="Apellidos"></div>
            <div class="col-12"><input type="text" class="form-control" placeholder="Dirección"></div>
            <div class="col-12"><input type="text" class="form-control" placeholder="Dirección cont. (opcional)"></div>
            <div class="col-md-4"><input type="text" class="form-control" placeholder="Ciudad"></div>
            <div class="col-md-4"><input type="text" class="form-control" placeholder="Estado / Provincia"></div>
            <div class="col-md-4"><input type="text" class="form-control" placeholder="Código Postal"></div>
            <div class="col-md-6"><input type="text" class="form-control" placeholder="Correo electrónico"></div>
            <div class="col-md-6"><input type="text" class="form-control" placeholder="Confirmar correo"></div>
          </form>
        </div>

        <!-- Pago -->
        <div class="card p-4 mb-4">
          <h5 class="mb-3">Pagar con</h5>
          <div id="pagoOpciones">
            <div class="pago-opcion mb-2" data-metodo="tarjeta">
              <input type="radio" name="pago" class="form-check-input me-2"> 
              Agregar una tarjeta nueva 
              <img src="https://img.icons8.com/color/48/000000/visa.png" width="40">
              <img src="https://img.icons8.com/color/48/000000/mastercard-logo.png" width="40">
            </div>
            <div class="pago-opcion mb-2" data-metodo="paypal">
              <input type="radio" name="pago" class="form-check-input me-2"> PayPal 
              <img src="https://img.icons8.com/color/48/000000/paypal.png" width="40">
            </div>
            <div class="pago-opcion" data-metodo="paypalcredit">
              <input type="radio" name="pago" class="form-check-input me-2"> PayPal Credit
            </div>
          </div>

          <!-- Datos de tarjeta -->
          <div id="datosTarjeta" class="mt-3">
            <input type="text" class="form-control mb-2" placeholder="Número de tarjeta">
            <div class="row">
              <div class="col-md-6"><input type="text" class="form-control mb-2" placeholder="MM/AA"></div>
              <div class="col-md-6"><input type="text" class="form-control mb-2" placeholder="CVV"></div>
            </div>
            <input type="text" class="form-control mb-2" placeholder="Nombre del titular">
          </div>
        </div>

        <!-- Cupones -->
        <div class="card p-4">
          <h5>Agregar cupones</h5>
          <p class="text-muted small">No se pueden aplicar las donaciones en este momento.</p>
        </div>
      </div>

      <!-- Resumen fijo -->
      <div class="col-lg-5">
        <div class="card p-4 resumen-fijo">
          <h5 class="mb-3">Resumen del pedido</h5>
          <div id="lista-productos"></div>
          <hr>
          <h5>Total <span class="float-end text-success" id="total-text">US $0.00</span></h5>
          <a href="chatBuyerToSeller.html"><button id="btnConfirmar" class="btn btn-pago w-100 mt-4" disabled>Confirmar y pagar</button></a>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal de Éxito -->
  <div class="modal fade" id="modalExito" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content text-center p-5">
        <lottie-player src="https://assets7.lottiefiles.com/packages/lf20_jbrw3hcz.json"
                       background="transparent" speed="1" style="width: 200px; height: 200px;" autoplay>
        </lottie-player>
        <h4 class="mt-3">¡Pago Exitoso!</h4>
        <p>Tu pedido ha sido confirmado y está en camino.</p>
        <button class="btn btn-primary" data-bs-dismiss="modal">Cerrar</button>
      </div>
    </div>
  </div>
  <!-- Footer -->
  <footer style="background-color: #1e1e1e; color: white; padding: 50px 20px 30px;">
    <div style="display: flex; flex-wrap: wrap; justify-content: space-around; max-width: 1200px; margin: auto;">
      <div style="flex: 1 1 220px; margin-bottom: 20px;">
        <h4 style="color: #f57c00;">MercaNova</h4>
        <p>Conectamos emprendedores con compradores de todo el país.</p>
      </div>
      <div style="flex: 1 1 180px; margin-bottom: 20px;">
        <h5 style="color: #f57c00;">Enlaces</h5>
        <ul style="list-style: none; padding: 0;">
          <li><a href="productos.html" style="color: #ccc;">Productos</a></li>
          <li><a href="productos-destacados.html" style="color: #ccc;">Destacados</a></li>
          <li><a href="nosotros.html" style="color: #ccc;">Nosotros</a></li>
          <li><a href="perfil.html" style="color: #ccc;">Perfil</a></li>
        </ul>
      </div>
      <div style="flex: 1 1 200px; margin-bottom: 20px;">
        <h5 style="color: #f57c00;">Contacto</h5>
        <p><strong>Email:</strong> contacto@mercanova.com</p>
        <p><strong>Tel:</strong> +503 1234 5678</p>
        <p><strong>Ubicación:</strong> San Salvador, El Salvador</p>
      </div>
      <div style="flex: 1 1 250px;">
        <h5 style="color: #f57c00;">Suscríbete</h5>
        <p>Recibe nuestras mejores ofertas en tu correo.</p>
        <form onsubmit="alert('Gracias por suscribirte'); return false;">
          <input type="email" placeholder="Tu correo electrónico" required style="padding: 10px; width: 100%; margin-bottom: 10px;" />
          <button type="submit" style="background-color: #f57c00; color: white; padding: 10px 20px;">Suscribirme</button>
        </form>
      </div>
    </div>
    <div style="text-align: center; padding-top: 20px; border-top: 1px solid #555; margin-top: 30px;">
      <p>&copy; 2025 MercaNova. Todos los derechos reservados.</p>
    </div>
  </footer>
<!--Fin del footer-->
  <script>
   const btnConfirmar = document.getElementById('btnConfirmar');
    const telefono = document.getElementById('telefono');
    const datosTarjeta = document.getElementById('datosTarjeta');

    document.querySelectorAll('.pago-opcion').forEach(el => {
      el.addEventListener('click', () => {
        document.querySelectorAll('.pago-opcion').forEach(op => op.classList.remove('active'));
        el.classList.add('active');
        el.querySelector('input[type="radio"]').checked = true;
        datosTarjeta.style.display = (el.dataset.metodo === 'tarjeta') ? 'block' : 'none';
        validarFormulario();
      });
    });

    document.addEventListener('input', validarFormulario);

    function validarFormulario(){
      let camposVacios = false;
      document.querySelectorAll('#formEnvio input').forEach(inp => {
        if(!inp.value.trim()) camposVacios = true;
      });
      if(!telefono.value.trim()) camposVacios = true;
      const metodoPago = document.querySelector('input[name="pago"]:checked');
      if(!metodoPago) camposVacios = true;
      if(metodoPago && metodoPago.parentElement.dataset.metodo === 'tarjeta'){
        document.querySelectorAll('#datosTarjeta input').forEach(inp => {
          if(!inp.value.trim()) camposVacios = true;
        });
      }
      btnConfirmar.disabled = camposVacios;
    }

    btnConfirmar.addEventListener('click', () => {
      let error = false;
      document.querySelectorAll('#formEnvio input, #telefono').forEach(inp => {
        if(!inp.value.trim()){ inp.classList.add('campo-error'); error = true; }
      });
      const metodoPago = document.querySelector('input[name="pago"]:checked');
      if(metodoPago && metodoPago.parentElement.dataset.metodo === 'tarjeta'){
        document.querySelectorAll('#datosTarjeta input').forEach(inp => {
          if(!inp.value.trim()){ inp.classList.add('campo-error'); error = true; }
        });
      }
      setTimeout(()=>document.querySelectorAll('.campo-error').forEach(i=>i.classList.remove('campo-error')),500);
      if(!error){
        const modalExito = new bootstrap.Modal(document.getElementById('modalExito'));
        modalExito.show();
        localStorage.removeItem("carrito");
      }
    });

    document.addEventListener("DOMContentLoaded", function () {
      const lista = document.getElementById("lista-productos");
      const carrito = JSON.parse(localStorage.getItem("carrito")) || [];
      let subtotal = 0;
      const costoEnvio = 5.99;
      
      carrito.forEach((producto, index) => {
        const precio = parseFloat(producto.precio.replace(/[^\d.]/g,'')) || 0;
        subtotal += precio;
        lista.innerHTML += `
          <div class="d-flex mb-2 align-items-center">
            <img src="${producto.img}" style="width:60px; height:60px; object-fit:cover;" class="me-2">
            <div><p class="mb-1">${producto.nombre}</p><small class="text-muted">Código: ${producto.id}</small></div>
            <span class="ms-auto me-2">US $${precio.toFixed(2)}</span>
            <button class="btn btn-sm btn-danger eliminar-producto" data-index="${index}">
              <i class="fa fa-trash"></i>
            </button>
          </div>`;
      });

      // Evento para eliminar productos
      document.querySelectorAll(".eliminar-producto").forEach(boton => {
        boton.addEventListener("click", function() {
          const index = this.getAttribute("data-index");
          carrito.splice(index, 1);
          localStorage.setItem("carrito", JSON.stringify(carrito));
          location.reload();
        });
      });
    });

    const menuBtn = document.getElementById('hamburguesaBtn');
    const menuDesplegable = document.getElementById('menuDesplegable');
    menuBtn.addEventListener('click', () => {
      menuDesplegable.style.display = menuDesplegable.style.display === 'none' || menuDesplegable.style.display === '' ? 'block' : 'none';
    });
    document.addEventListener('click', function(event) {
      if (!menuBtn.contains(event.target) && !menuDesplegable.contains(event.target)) {
        menuDesplegable.style.display = 'none';
      }
    });
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
